name: Flutter CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: subosito/flutter-action@v1
      with:
        flutter-version: '2.2.3'

    - name: Get dependencies
      run: flutter pub get

    - name: Run tests
      run: flutter test
    
    # Add your build steps here
    - name: Install Firebase CLI
      run: curl -sL https://firebase.tools | bash

    - name: Deploy to Firebase App Distribution
      env:
        FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
      run: |
        flutter build apk # or flutter build ios for iOS apps
        firebase appdistribution:distribute build/app/outputs/flutter-apk/app-release.apk \
          --app 1:1045700430760:android:bc13c4911804741023eb9d \
          --token $FIREBASE_TOKEN \
          --groups "testers" # or --testers "email1,email2"
